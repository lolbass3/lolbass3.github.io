var BLVDDependenciesLoaded=BLVDDependenciesLoaded||!1,BLVDTemplates=BLVDTemplates||!1;!function(t){var e=function(e,n,i){function o(){ue=t('<div class="blvd-loading"><div>Loading</div></div>').height(Pe.height()),Pe.append(ue)}function r(){ue.animate({opacity:0},function(){ue.remove()})}function a(){o(),Pe.addClass("player-container"),ce=V,Y=new Le,oe=new we,t.when(oe.load(V.pluginPath),Y.load(V.pluginPath)).done(function(){U=new ye,U.init(),ne=Pe.find(F.playerLayoutOuter),q=new be,q.init(V.jPlayer),H=new de,G=new Ce,Q=new me,J=new ge,R=new ve,l(),M.on("playlistInit",function(){U.manageLayout()}),t(window).on("resize."+N,function(){U.setLayoutParams()}),M.on("playlistInit playlistAdvance",function(){G.setBackground()}),M.on("playlistAdvance playlistInit",function(){U.setTitle()}),t(window).onThrottled("resize."+N,500,function(){G.setBackground(),U.resize()}),t(".toggle-layout").on("click",function(){le.length<=1||(se++,se>le.length-1&&(se=0),s(le[se]))}),r(),$e=!0,M.publish("started")})}function l(){var e=t.extend(!0,{},V);le=V.additionalLayoutConfigs||[],le.push(e),se=le.length-1}function s(e){1!=ae&&(o(),ae=!0,V=t.extend(!0,{},ce,e),M.publish("layoutSwitching",V),t.when(U.setLayout(V.layout)).then(G.resetBackground).done(function(){ae=!1,r(),M.publish("layoutSwitchComplete")}))}function c(t,e){ne.attr(t,e)}function u(t){return"number"==typeof t&&isFinite(t)&&t>-9007199254740992&&9007199254740992>t&&Math.floor(t)===t}function p(){Pe.off(),Pe.empty(),t(window).off("resize."+N),q.destroy()}function f(t){u(t)&&V.additionalLayoutConfigs&&V.additionalLayoutConfigs[t]&&(se=t,t=V.additionalLayoutConfigs[se]),s(t)}function d(){U.manageLayout(!0),G.setBackground()}function h(){G.setBackground()}function y(e){e&&(V=t.extend(!0,{},V,e)),a()}function v(){return $e===!0}function m(){var t=Array.prototype.slice.call(arguments);M.off.apply(this,t)}function g(){var t=Array.prototype.slice.call(arguments);M.on.apply(this,t)}function b(){var t=Array.prototype.slice.call(arguments);M.once.apply(this,t)}function C(){return V}function k(){U.manageLayout(!0)}function w(){q.play()}function L(){q.pause()}function P(){q.playlistNext()}function $(){q.playlistPrev()}function A(){q.togglePlay()}function S(e){V=t.extend(!0,{},V,e),ce=t.extend(!0,{},ce,e)}function x(t){n=t,q.playlistInit(!0),U.setTitle(),k()}function I(t){q.setPlaylist(t)}function z(){return new de}function j(){return n}function D(t){return t=t.split("/"),t[t.length-1]}function T(){return(new Date).getTime()+"-"+Math.floor(1e5*Math.random())+1}function B(t){return t.substr(1)}function E(t){return"undefined"==typeof t}function O(t){console.log("ERROR: "+t)}var M,N,W,V,F,q,H,G,Q,J,R,Y,U,X,_,K,Z,te,ee,ne,ie,oe,re,ae,le,se,ce,ue,pe,fe,de,he,ye,ve,me,ge,be,Ce,ke,we,Le,Pe=e,$e=!1;return F={jPlayer:"#jquery_jplayer",jPlayerInterface:".jp-interface",playerPrevious:".jp-previous",playerNext:".jp-next",volume:".volume",trackList:".track-list",tracks:".tracks",track:".track",trackInfo:".track-info",trackTitle:".track-title",trackArtist:".track-artist",trackNumber:".track-number",playerTitle:".player-track-info",duration:".duration",buy:".buy",buyNotActive:".not-active",playing:".playing",moreButton:".more",player:".player",artist:".artist",artistOuter:".artist-outer",albumCover:".album-cover",albumCoverImage:".image",description:".description",descriptionShowing:".showing",albumCoverNaviation:".album-covers-wrapper",playerLayoutOuter:".player-layout-outer",playerLayout:".player-layout",playerLayoutInner:".player-layout-inner",playerControls:".player-controls",playerBackgroundOuter:".player-background-outer"},W={autoPlay:!1,overlayOpacity:".6",overlayColor:"dominant",gradientType:"vertical",gradientDegrees:"80deg",styleType:"blur",layout:"album-covers",smallScreenLayout:"single-album-cover",layoutType:!1,jPlayer:{},autoLoadDependencies:!0,backgroundImageSource:"cover",pluginPath:"boulevard/",smallScreenSize:640,imageEffects:!1,groupAlbumCoversInMiddle:!0,additionalLayoutConfigs:!1,autoStart:!0,baseLayout:!1},t.fn.onThrottled=function(t,e,n){var i=!1;this.on(t,function(){i||(setTimeout(function(){n(),i=!1},e),i=!0)})},pe=function(){function e(t,e){r.on(t,e)}function n(t,e){var n=function(){r.off(t,n),e.apply(this,Array.prototype.slice.call(arguments,1))};r.on(t,n)}function i(t){r.trigger(t,Array.prototype.slice.call(arguments,1))}function o(t,e){r.off(t,e)}var r=t("<b/>");return{on:e,once:n,off:o,publish:i}},M=new pe,ve=function(){function t(t){return E(n[t].artist)?"-":n[t].artist}function e(t){return E(n[t].duration)?"-":n[t].duration}function i(t){return E(n[t].title)?E(n[t].mp3)?E(n[t].oga)?"":D(n[t].oga):D(n[t].mp3):n[t].title}return{trackName:i,artist:t,duration:e}},be=function(){function e(e){var n=Pe.find(F.player),o="jp-interface-"+N;n.addClass(o),b=Pe.find(".jPlayer-container");var r,s,u=3;r={swfPath:V.pluginPath+"dependencies/jquery-jplayer",supplied:"mp3",cssSelectorAncestor:"."+o,errorAlerts:!1,warningAlerts:!1},s=t.extend(!0,{},r,e),b.bind(t.jPlayer.event.ready,function(){b.bind(t.jPlayer.event.ended,function(){l()}),b.bind(t.jPlayer.event.play,function(){b.jPlayer("pauseOthers")}),b.bind(t.jPlayer.event.playing,function(){g=!0}),b.bind(t.jPlayer.event.pause,function(){g=!1}),Pe.find(F.playerPrevious).on("click",function(){return c(),t(this).blur(),!1}),Pe.find(F.playerNext).on("click",function(){return l(),t(this).blur(),!1}),Pe.find(F.volume).on("click",function(){var e=[0,33,66,100],n=["mute","low","medium","high"];u++,u>e.length-1&&(u=0),b.jPlayer("volume",e[u]/100),t(this).attr("data-level",n[u])}),M.on("initPlaylistAdvance",function(t,e){e!=X?a(e):b.data("jPlayer").status.srcSet?h():a(0)}),i(V.autoplay)}),b.jPlayer(s)}function i(t){X=0,t?a(X,null,!1):(r(X),M.publish("playlistInit"))}function o(t){X=0,n=t,r(X),U.setTitle()}function r(t){s()&&(X=t,b.jPlayer("setMedia",n[X]))}function a(t,e,n){s()&&(e||(e=X==f()&&0==t?"next":0==X&&t==f()?"prev":t>X?"next":"prev"),r(t),n!==!1&&M.publish("playlistAdvance",e),y())}function l(){if(s()){var t=u();a(t,"next")}}function s(){return _===!1}function c(){var t=p();a(t,"prev")}function u(){return X+1<n.length?X+1:0}function p(){return X-1>=0?X-1:d()}function f(){return n.length-1}function d(){return n.length-1}function h(){g?b.jPlayer("pause"):y()}function y(){b.jPlayer("play")}function v(){b.jPlayer("pause")}function m(){b.jPlayer("destroy")}var g=!1,b={};return{init:e,playlistInit:i,setPlaylist:o,playlistAdvance:a,playlistNext:l,playlistPrev:c,play:y,pause:v,getNextIndex:u,getPrevIndex:p,togglePlay:h,getIndexOfLastItem:d,$myJplayer:b,destroy:m}},Ce=function(){function e(){J=ee.$canvas?ee.$canvas:!1,ee.$canvas=Y.$get("canvas"),ee.$canvas.css("opacity",0),ee.canvas=ee.$canvas.get(0),ee.context=ee.canvas.getContext("2d"),ee.id=T(),ee.$canvas.attr("id",ee.id)}function i(){J&&J.animate({opacity:0},function(){ee.$canvas.siblings("canvas").remove()})}function o(){J&&jQuery.contains(ie[0])?oe.find("canvas.player-background").before(ee.$canvas):oe.append(ee.$canvas)}function r(t,e){var n=e||1,i=oe.width()*n,o=oe.height()*n,r=t.width/t.height,a=i,l=a/r;return o>l&&(l=o,a=l*r),{width:a,height:l}}function a(t){var e=t.height,n=t.width;ee.canvas.width=n,ee.canvas.height=e}function l(){ee.context.drawImage(Z,0,0)}function s(t){var e="blur"!=V.styleType&&"blur-player"!=V.styleType?1:2,n=r(t,e);ee.$canvas.width(n.width).height(n.height),ee.$canvas.css({left:-(n.width-oe.width())/2,top:-(n.height-oe.height())/2})}function u(){var e=t.Deferred(),n=new Image;return n.onload=function(){e.resolve()},p(),n.src=R,Z=n,e}function p(){R="image"==V.backgroundImageSource&&"undefined"!=typeof n[X].background?n[X].background:n[X].cover?n[X].cover:!1}function f(e){var n=t.Deferred();return RGBaster.colors(e,function(t){K=t,n.resolve(t)},20),n}function d(t){var e=t.match(/\d+/g),n=(299*e[0]+587*e[1]+114*e[2])/1e3;return 128>=n?"dark-bg":"light-bg"}function h(){var e,n=t.Deferred();return e=t('<img class="temp-image-for-dominant-color-extraction" src='+R+" />").get(0),t.when(f(e)).done(function(){y(),n.resolve()}),n}function y(){var t=d(K.dominant);"overlay"==te||"overlay-simple"==te||"dominant-color"==te?m(t):ne===!0&&g(),v(t),M.publish("colorsProcessed",K,t)}function v(t){c("data-secondary-color",t)}function m(t){ne=!0,c("data-color",t)}function g(){ne=!1,c("data-color","")}function b(t){U=Y.$get(t)}function C(){var t="dominant"==V.overlayColor;U||(b("overlay-background"),$()),k(t===!0?z(K.dominant,V.overlayOpacity):V.overlayColor)}function k(t){{var e,n,i,o,r="string"==typeof t?[t]:t;V.overlayOpacity}if("none"!=t)if(1==r.length)e=r[0],n=z(r[0],.2),P(e),w(n);else{i=r[0],o=r[1];var a={color1:i,color2:o,deg:V.gradientDegrees},l=ke.generate(V.gradientType,a);U.attr("style",l)}}function w(t){ie.find(F.playerControls).css("background",t)}function L(){ie.find(F.playerControls).css("background","")}function P(t){U.css("background",t)}function $(){var e=t.Deferred();return U.css("opacity",0),oe.append(U),A()||(U.css("opacity",1),e.resolve()),U.animate({opacity:1},function(){U.trigger("click"),S(),e.resolve()}),e}function A(){return _&&_.length}function S(){A()&&_.remove()}function x(){var e=t.Deferred();return b("dominant-color-background"),P(K.dominant),t.when($()).done(function(){e.resolve()}),e}function I(t){return t.replace(/[^\d,]/g,"").split(",")}function z(t,e){var n=I(t);return n.length>3&&n.pop(),"rgba("+n.join(",")+","+e+")"}function j(){return U?!1:(b("general-background"),$())}function D(n){var r=t.Deferred();return e(),a(Z),o(),t.when(O()).done(function(){s(Z),B(),n!==!1&&i(),r.resolve()}),r}function B(){ee.$canvas.animate({opacity:1})}function E(e){var n=t.Deferred();return t.when(D(!1)).done(function(){e(),i(),n.resolve()}),n}function O(){var e,n=t.Deferred();return e=!0,t.when(e).done(function(){t.when(N()).done(function(){n.resolve()})}),n}function N(){var e,n=t.Deferred();if(("blur"==te||"blur-player"==te)&&(V.imageEffects="stackBlur[20]"),V.imageEffects===!1||""===V.imageEffects)return l(),n.resolve(),n;if(e=V.imageEffects.split("|"),jQuery.contains(Pe[0],ee.$canvas[0]))var i=Caman(ee.$canvas[0],R,function(){Caman.Event.listen(i,"processComplete",function(){0==this.renderer.renderQueue.length&&n.resolve()}),t.each(e,function(t,o){var r,a,l=o.match(/(.*?)\[(.*?)\]/);l?(r=l[1],a=l[2].split(",")):(r=o,a=[]),i[r]&&i[r].apply(i,a),i.render(),"stackBlur"==r&&1==e.length&&n.resolve()})});return n}function W(){return V.imageEffects="greyscale",q()}function q(){return E(function(){C()})}function H(){var e=!1;switch(te){case"dominant-color":e=x();break;case"blur":e=D();break;case"blur-player":e=D(),t.when(e).done(j);break;case"overlay-simple":e=q();break;case"overlay":e=W();break;case"image":e=D();break;default:j()}return e}function G(){var e=t.Deferred();return te=V.styleType,c("data-style-type",te),_=Pe.find(".player-background"),M.publish("settingBackground",te),L(),t.when(u()).then(h).then(H).done(function(){e.resolve(),M.publish("backgroundSet")}),e}function Q(){U=null;var e=ie.find(".player-background");e.removeClass("player-background").addClass("old-player-background").css("z-index",1),t.when(G()).done(function(){e.animate({opacity:0},function(){e.remove()})})}var J,R,U,_,K,Z,te,ee={},ne=!1,oe=t(F.playerBackgroundOuter);return{setBackground:G,resetBackground:Q}},ke=function(){function t(t,e){var n="background-image: -webkit-linear-gradient(left, {color1} 0%, {color2} 100%); // Safari 5.1-6, Chrome 10+background-image: -o-linear-gradient(left, {color1} 0%, {color2} 100%); // Opera 12background-image: linear-gradient(to right, {color1} 0%, {color2} 100%); // Standard, IE10, Firefox 16+, Opera 12.10+, Safari 7+, Chrome 26+background-repeat: repeat-x;progid:DXImageTransform.Microsoft.gradient(startColorstr='{color1}', endColorstr='{color2}', GradientType=1);";return n.replace(/\{color1\}/g,t).replace(/\{color2\}/g,e)}function e(t,e){var n="background-image: -webkit-linear-gradient(top, {color1} 0%, {color2} 100%);  // Safari 5.1-6, Chrome 10+background-image:  -o-linear-gradient(top, {color1} 0%, {color2} 100%);  // Opera 12background-image: linear-gradient(to bottom, {color1} 0%, {color2} 100%); // Standard, IE10, Firefox 16+, Opera 12.10+, Safari 7+, Chrome 26+background-repeat: repeat-x;progid:DXImageTransform.Microsoft.gradient(startColorstr='{color1}', endColorstr='{color2}', GradientType=0)";return n.replace(/\{color1\}/g,t).replace(/\{color2\}/g,e)}function n(t,e,n){var i="background-repeat: repeat-x;background-image: -webkit-linear-gradient({deg}, {color1}, {color2}); // Safari 5.1-6, Chrome 10+background-image: -o-linear-gradient({deg}, {color1}, {color2}); // Opera 12background-image: linear-gradient({deg}, {color1}, {color2}); // Standard, IE10, Firefox 16+, Opera 12.10+, Safari 7+, Chrome 26+";return i.replace(/\{color1\}/g,e).replace(/\{color2\}/g,n).replace(/\{deg\}/g,t)}function i(t,e){var n="background-image: -webkit-radial-gradient(circle, {color1}, {color2});background-image: radial-gradient(circle, {color1}, {color2});background-repeat: no-repeat;";return n.replace(/\{color1\}/g,t).replace(/\{color2\}/g,e)}function o(o,r){var a;switch(o){case"vertical":a=e(r.color1,r.color2);break;case"horizontal":a=t(r.color1,r.color2);break;case"directional":a=n(r.deg,r.color1,r.color2);break;case"radial":a=i(r.color1,r.color2)}return a}return{generate:o}}(),we=function(){function e(){"undefined"==typeof yepnope&&O("YepNope is not defined. You must include YepNope in your page for the plugin to work.")}function n(e){var n,i,o=t.Deferred();if(!V.autoLoadDependencies||BLVDDependenciesLoaded===!0)return o.resolve(),o;if(i={rgbraster:["dependencies/rgbraster.js"],jplayer:["dependencies/jquery-jplayer/jquery.jplayer.min.js"],nanoscroller:["dependencies/nanoScrollerJS/jquery.nanoscroller.min.js","dependencies/nanoScrollerJS/nanoscroller.css"],camanjs:["dependencies/CamanJS/caman.full.min.js"]},e){var r={};t.each(i,function(n,i){var o=[];t.each(i,function(t,n){o.push(e+n)}),r[n]=o}),i=r}return n=[],t.each(i,function(t,e){n=n.concat(e)}),yepnope({load:n,complete:function(){BLVDDependenciesLoaded=!0,o.resolve()}}),o}return e(),{load:n}},Le=function(){var e;this.load=function(n){var i;return BLVDTemplates!==!1?(e=BLVDTemplates,!0):i=t.ajax({url:n+"templates.html",success:function(n){e=t(n),BLVDTemplates=e}})},this.$get=function(t){return e.filter("#"+t).children().clone()}},ye=function(){function e(){s(),C(),o(),n()}function n(){var t=Pe.height(),e=Pe.width();(0==t||0==e)&&(t=Pe.parent().height()||281,e=Pe.parent().width()||500,Pe.css({"min-height":t,"min-width":e}))}function i(t,e){var n=new fe;n.name=t,e.init&&(n.init=function(){fe.prototype.init.apply(n),e.init.apply(n),fe.prototype.postInitProcessing.apply(n)}),e.position&&(n.position=function(){e.position.apply(n)}),P[t]=n}function o(){i("album-cover-and-list",{init:function(){H.setAlbumCoverLayout("single"),Q.buildTrackList()},position:function(){var t=this.$inner.height()-H.getAlbumCoverSize()-75;this.$albumCover.css("margin-top",t),this.$trackList.css("margin-top",t)}}),i("album-cover-and-list-fill-space",{init:function(){H.setAlbumCoverLayout("single-fill-space"),Q.buildTrackList()}}),i("single-album-cover",{init:function(){H.setAlbumCoverLayout("single")},position:function(){var t=this.$inner.height()-H.getAlbumCoverSize()-120;0>t&&(t=0),this.$albumCover.css("margin-top",t)}}),i("album-covers",{init:function(){H.setAlbumCoverLayout()},position:function(){var t=this.$inner.height()-H.getAlbumCoverSize()-120;0>t&&(t=0),this.$albumCover.css("margin-top",t)}}),i("info-and-album-cover",{init:function(){H.setAlbumCoverLayout("single"),J.init()},position:function(){var t=this.$inner.height()-H.getAlbumCoverSize()-75;this.$albumCover.css("margin-top",t),t=t+H.getAlbumCoverSize()/2-this.$trackInfo.height()/2,this.$trackInfo.css("margin-top",t)}}),i("info-and-list",{init:function(){J.init(),Q.buildTrackList()},position:function(){var t=this.$inner.height()/2-this.$trackInfo.height();this.$trackInfo.css("margin-top",t)}}),i("info",{init:function(){J.init()},position:function(){var t=this.$inner.height()/2-this.$trackInfo.height()/2;this.$trackInfo.css("margin-top",t)}}),i("album-cover-tiles",{init:function(){H.setAlbumCoverLayout("wall")}}),i("album-cover-wall",{init:function(){H.setAlbumCoverLayout("wall")}}),i("list",{init:function(){Q.buildTrackList()}}),i("blank",{})}function r(e){var n=!1,i=t.Deferred(),o=e||V.layout;return M.publish("settingLayout",o),re&&(n=P[re].destroy()),t.when(n).done(function(){return re=o,P[o]?(c("data-layout",o),f(),ie=Pe.find(F.playerLayout),k(),P[o].init(),i.resolve(),void M.publish("layoutSet")):(O(o+" is not a valid layout name"),!1)}),i}function a(){return P[re]}function l(){L=Pe.find(F.playerTitle)}function s(e){var n;e=e||V.layout,n=V.baseLayout?V.baseLayout instanceof jQuery?V.baseLayout.clone():t(V.baseLayout):Y.$get("base-layout"),n.length||O("Invalid layout name"),n.css({opacity:0}).appendTo(Pe),w=Y.$get("player-interface"),Pe.find(".player-controls-outer").append(w),l(),n.animate({opacity:1})}function u(){if(V.layoutType){var e=V.layoutType.split(" ");t.each(e,function(t,e){Pe.addClass("forced-"+e),"mini"==e||"mini2"==e?v(e):"mini-height"==e&&g()})}}function p(t){var e=Pe.width();e<=V.smallScreenSize&&(re!=V.smallScreenLayout||t===!0)?r(V.smallScreenLayout):e>V.smallScreenSize&&(re!=V.layout||t===!0)&&r(V.layout),y()}function f(){var t=Y.$get(re);t.length||O("No template for this layout - "+re),Pe.find(".player-layout").prepend(t.find(".player-layout-inner"))}function d(){var t,e=R.artist(X);t=e?R.trackName(X)+" - "+e:R.trackName(X),L.html(t)}function h(){p()}function y(){var t=Pe.width()<=V.smallScreenSize,e="undefined"==typeof K,n=Pe.height()<=500,i="undefined"==typeof Z;return V.layoutType?void u():(!t||K&&!e?t||!K&&!e||m():v(),void(!n||Z&&!i?n||!Z&&!i||b():g()))}function v(t){t=t||"mini",K=!0,Pe.addClass(t)}function m(){K=!1,Pe.removeClass("mini mini2")}function g(){Z=!0,Pe.addClass("mini-height")}function b(){Z=!1,Pe.removeClass("mini-height")}function C(){function e(){for(var t="",e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",n=0;5>n;n++)t+=e.charAt(Math.floor(Math.random()*e.length));return t}var n,i,o,r,a;n=e(),i=n+T(),r="#"+i,o=r+"{position: absolute;bottom: 100px;right: 20px;color: #fff; opacity: .2; font-size: 11px;text-decoration:none; }"+r+":hover{ color: #fff; opacity: .5;}.mini-height "+r+'{bottom:70px;}[data-color="light-bg"] '+r+"{color:#222;}",t("head").append('<style type="text/css">'+o+"</style>"),a=t('<a id="'+i+'" href="http://boulevardjs.com" target="_blank">powered by Boulevard</a>'),Pe.find(F.playerControls).before(a)}function k(){ee={playerWidth:Pe.width(),playerHeight:w.height(),playerTopMargin:parseInt(Pe.find(F.playerLayoutInner).css("padding-top"),10)}}var w,L,P={};return{setLayoutParams:k,buildInterface:s,setTitle:d,managePlayerControlsStyle:y,resize:h,getCurrentLayout:a,setLayout:r,manageLayout:p,init:e}},fe=function(){this.id=T(),this.name="",this.domElementsWithEventHandlers=[]},fe.prototype.domElements={$inner:".player-layout-inner",$albumCover:".album-covers-wrapper",$trackList:".track-list-wrapper",$trackInfo:".track-info-wrapper",$controls:".player-controls"},fe.prototype.init=function(){this.initDomElements()},fe.prototype.postInitProcessing=function(){var e=this;this.position(),this.bind(t(window),"resize",function(){e.position()})},fe.prototype.position=function(){},fe.prototype.initDomElements=function(){var e=this;t.each(this.domElements,function(t,n){e[t]=Pe.find(n)})},fe.prototype.bind=function(t,e,n){var i,o;n?(i=t,o=e):(i=Pe,o=t,n=e),i.on(o+"."+this.name,n),this.addEvent(i)},fe.prototype.addEvent=function(t){this.domElementsWithEventHandlers.push(t)},fe.prototype.destroy=function(){var e=this,n=t.Deferred();return t.each(this.domElementsWithEventHandlers,function(t,n){n.off("."+e.name)}),this.domElementsWithEventHandlers=[],Pe.find(".player-layout-inner").animate({opacity:0},function(){Pe.find(".player-layout-inner").off().empty().remove(),n.resolve()}),n},me=function(){function e(){l=Pe.find(F.tracks);for(var e=0;e<n.length;e++){var r=Y.$get("list-item");r.find(F.trackNumber).html(e+1),r.find(F.trackTitle).html(R.trackName(e)),r.find(F.trackArtist).html(R.artist(e)),r.find(F.duration).html(R.duration(e)),r.data("index",e),r.attr("data-index",e),l.append(r)}a=l.find(F.track),a.on("click",function(){M.publish("initPlaylistAdvance",t(this).data("index")),a.eq(X).addClass(B(F.playing)).siblings().removeClass(B(F.playing))}),i(),o()}function i(){var t,e,n=Pe.find(F.trackList);if(H.hasAlbumCovers())var i=H.getAlbumCoverSize();else i="100%";e=i,t=l.height(),e>t&&t>0&&(e=t),n.height(e).width(i),n.nanoScroller()}function o(){t(window).on("resize."+N,function(){i()}),M.on("playlistAdvance playlistInit",function(){r()})}function r(){a&&a.eq(X).addClass("playing").siblings(".playing").removeClass("playing")}var a,l;return{buildTrackList:e,setTrackListSize:i}},ge=function(){function e(){r=!0,a=Pe.find(".track-info-wrapper"),l=a.find(".track-name").find("span"),s=a.find(".track-artist").find("span"),c||o(),c=!0,n()}function n(){r&&(c||e(),l.html(R.trackName(X)),s.html(R.artist(X)),i())}function i(){var e=a.width(),n=u[2e3];t.each(u,function(t,i){return e<=parseInt(t,10)?(n=i,!1):void 0}),a.attr("data-size",n)}function o(){M.on("playlistInit playlistAdvance",function(){n()}),t(window).on("resize."+N,function(){i()})}var r,a,l,s,c=!1,u={150:"tiny",250:"x-small",400:"small",600:"medium",800:"large",1200:"x-large",1600:"2x-large",2e3:"3x-large"};return{init:e}},de=function(){this.initialized=!1,this.animationDuration=500,this.anchorWidth=null,this.albumCoverLayout=!1,this.albumCoversByPosition={},this.$anchor=!1},de.prototype.init=function(t){t=t||{},this.$anchor=t.$anchor?t.$anchor:Pe.find(F.albumCoverNaviation),n.length<=1&&!this.albumCoverLayout&&(this.albumCoverLayout="single"),this.manageAlbumCoverLayout(),this.bindDomEvents(),this.initialized||this.bindPlayerEvents(),this.initialized=!0},de.prototype.positionAndSizeAlbumCovers=function(){t.each(this.albumCoversByPosition,function(t,e){e.setAlbumCoverSize(),e.setPosition(parseInt(t))})},de.prototype.changeCurrentlyPlaying=function(t){"single"==this.albumCoverLayout||"single-fill-space"==this.albumCoverLayout?this.setSingleAlbumCoverLayout():"wall"==this.albumCoverLayout||this.moveAlbumCoversOnPlaylistAdvance(t)},de.prototype.handleAlbumCoverClick=function(t){if("single"!=this.albumCoverLayout){var e=t.parent().data("cover");2==e.position?q.togglePlay():q.playlistAdvance(e.index)}},de.prototype.verifyAlbumCoverForPrevSongSet=function(){"undefined"==typeof this.albumCoversByPosition[3]&&this.addAlbumCover(q.getIndexOfLastItem(),3)},de.prototype.addAlbumCover=function(t,e,n){var i;i="undefined"!=typeof n?n:e;var o=new he({animationDuration:this.animationDuration,$anchor:this.$anchor,index:t,position:i});this.logAlbumCoverPosition(o,e),o.render(),"undefined"!=typeof n&&o.setPosition(e,!0)},de.prototype.logAlbumCoverPosition=function(t,e){this.albumCoversByPosition[e]=t},de.prototype.getAlbumCoverAtPosition=function(t){return this.albumCoversByPosition[t]},de.prototype.clearAlbumCovers=function(){t.each(this.albumCoversByPosition,function(t,e){e.remove()}),this.albumCoversByPosition={}},de.prototype.moveAlbumCoversOnPlaylistAdvance=function(e){var n=this,i=[];"prev"==e&&this.verifyAlbumCoverForPrevSongSet(),_=!0,t.each(this.albumCoversByPosition,function(o,r){var a;"next"==e?a=r.increasePosition():"prev"==e&&(a=r.decreasePosition()),i.push(a),t.when(a).done(function(){r.position>3||r.position<1?r.remove():n.logAlbumCoverPosition(r,r.position)})}),t.when.apply(t,i).done(function(){_=!1});var o,r,a;"next"==e?(o=1,r=q.getNextIndex(),a=0):"prev"==e&&(o=3,r=q.getPrevIndex(),a=4),this.addAlbumCover(r,o,a)},de.prototype.setSingleAlbumCoverLayout=function(){var t;te=1,this.clearAlbumCovers(),t=new he({position:2,$anchor:this.$anchor,index:X,type:this.albumCoverLayout}),this.logAlbumCoverPosition(t,2),t.render()},de.prototype.setAlbumCoverWallLayout=function(){for(var e=this,i=[],o=this.$anchor.height(),r=this.$anchor.width(),a=r/5,l=Math.ceil(o/a),s=5*l,c=Math.ceil(s/n.length),u=0,p=(n.length*c-s,0);c>p;p++)t.each(n,function(t){if(u>=s)return!1;var n=new he({$anchor:e.$anchor,index:t,setSize:!1});i.push(n.render()),u++});t.when.apply(t,i).done(function(){e.sizeWallContainer(),e.$anchor.parents(".nano").first().nanoScroller()})},de.prototype.sizeWallContainer=function(){this.$anchor.parent().height(this.$anchor.parents(".player-layout-inner").height())},de.prototype.initLayout=function(t){var e;te=3,e=t!==!1?0:!1,this.clearAlbumCovers(),this.addAlbumCover(X,2,e),this.addAlbumCover(q.getNextIndex(),1,e)},de.prototype.getAlbumCoverSize=function(){return this.albumCoversByPosition[2].size},de.prototype.hasAlbumCovers=function(){return"undefined"!=typeof this.albumCoversByPosition[2]},de.prototype.setAlbumCoverLayout=function(t,e){this.albumCoverLayout=t,this.init(e)},de.prototype.manageAlbumCoverLayout=function(){"single"==this.albumCoverLayout||"single-fill-space"==this.albumCoverLayout?this.setSingleAlbumCoverLayout():"wall"==this.albumCoverLayout?this.setAlbumCoverWallLayout():this.initLayout(!1)},de.prototype.bindDomEvents=function(){var e=this;this.$anchor.on("click",".album-cover",function(){e.handleAlbumCoverClick(t(this))})},de.prototype.bindPlayerEvents=function(){var e=this;M.on("playlistAdvance",function(t,n){e.changeCurrentlyPlaying(n)}),M.on("settingLayout",function(){e.clearAlbumCovers()}),t(window).on("resize."+N,function(){"wall"!=e.albumCoverLayout?e.positionAndSizeAlbumCovers():e.sizeWallContainer()})},he=function(t){this.$element=!1,this.margin=80,this.verticalMargin=120,this.position=t.position,this.$anchor=t.$anchor,this.id=T(),this.animationDuration=t.animationDuration,this.index=t.index,this.media=n[this.index],this.autoSetSize="undefined"!=typeof t.setSize?t.setSize:!0,this.type=t.type},he.prototype.build=function(){this.$element=Y.$get("album-cover"),this.$albumCoverImage=this.$element.find(F.albumCoverImage)},he.prototype.setInfo=function(){this.$element.find(F.trackTitle).html(this.media.title),this.$element.find(F.trackArtist).html(this.media.artist)},he.prototype.remove=function(){this.$element.remove(),Pe.off("."+this.id)},he.prototype.calculatePosition=function(t){return 1==V.groupAlbumCoversInMiddle?this.calculatePositionGroupedInMiddle(t):this.calculatePositionUsingAllSpace(t)},he.prototype.calculatePositionGroupedInMiddle=function(t){var e,n=this,i=n.totalSize*(t-1)+n.margin/2;return e=0>i?i:i+this.offset,e+"px"},he.prototype.calculatePositionUsingAllSpace=function(t){var e,n,i,o,r,a,l,s;return n=ee.playerWidth,o=this.margin,r=(n-this.size)/2,a=n-this.margin-this.size,s=a-r,i=o-s,l=a+s,e=[i,o,r,a,l],e[t]},he.prototype.setPosition=function(e,n){var i,o,r=this,a=new t.Deferred;return this.position=e,this.$element.attr("data-position",e),1==te?(a.resolve(),a):(this.$element.css({position:"absolute"}),n?(o={duration:this.animationDuration,complete:function(){a.resolve()}},i={right:r.calculatePosition(e)},this.$element.stop().animate(i,o)):(this.$element.css({right:r.calculatePosition(e)}),a.resolve()),a)},he.prototype.setMiniPosition=function(){var t=this;this.$element.css({"margin-top":t.$anchor.height()-this.size-75})},he.prototype.increasePosition=function(){return this.setPosition(this.position+1,!0)},he.prototype.decreasePosition=function(){return this.setPosition(this.position-1,!0)},he.prototype.setSize=function(t){this.size=t,this.totalSize=this.size+this.margin},he.prototype.setAlbumCoverSize=function(){var t,e=this.$anchor.outerWidth();return this.autoSetSize!==!1?(t="single-fill-space"!=this.type?this.calculateSize(e):this.calculateSizeToFillSpace(),this.setSize(t),this.calculateOffset(e),this.$element.width(t).find(F.albumCover).height(t).width(t),"single-fill-space"==this.type&&this.positionInCenter(t),t):void 0},he.prototype.positionInCenter=function(t){var e=this.$anchor.width(),n=this.$anchor.height();this.$element.css({left:(e-t)/2,top:(n-t)/2})},he.prototype.calculateSize=function(t){var e=Pe.height()-ee.playerHeight-ee.playerTopMargin-this.verticalMargin;return(e+this.margin)*te>t&&(e=t/te-this.margin),Math.floor(e)},he.prototype.calculateSizeToFillSpace=function(){var t=this.$anchor.width(),e=this.$anchor.height();return t>e?t:e},he.prototype.calculateOffset=function(t){var e=(t-this.totalSize*te)/2;0>e&&(e=0),this.offset=e},he.prototype.render=function(){return this.build(),this.setAlbumCoverSize(),this.setInfo(),"undefined"!=typeof this.position&&this.setPosition(this.position),this.$element.data("cover",this),this.$element.appendTo(this.$anchor),this.setCover(this.media)},he.prototype.setCover=function(e){var n=this,i=t.Deferred();return this.$albumCoverImage.animate({opacity:0},"fast",function(){if(!E(e.cover)){var o=X,r=new Image,a=t('<img  alt="album cover" />').css("opacity",0);n.$albumCoverImage.prepend(a),a.attr("src",e.cover),r.onload=function(){o==X&&(a.css("opacity",1),n.$albumCoverImage.animate({opacity:1})),i.resolve()},r.src=e.cover}}),i},V=t.extend(!0,{},W,i),X=0,_=!1,ae=!1,N=T(),V.autoStart===!0&&a(),{start:y,hasStarted:v,destroy:p,setLayout:f,manageLayout:d,on:g,once:b,off:m,getOptions:C,redraw:k,redrawBackground:h,play:w,pause:L,prev:$,next:P,togglePlay:A,setOptions:S,swapPlaylist:x,setPlaylist:I,getAlbumCoverManager:z,$anchor:Pe,getPlaylist:j}};t.fn.ttwBoulevard=function(t,n){return new e(this,t,n)}}(jQuery);